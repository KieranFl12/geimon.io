<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://fonts.googleapis.com/css?family=Racing Sans One' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <title>MAIN PAGE</title>
    <body style="background-color:rgb(0, 0, 0);">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <div class="container">
        <a href="https://docs.google.com/document/d/1xF4fIeB9r2qQyF3x0cW7tvZFpIDo4apNW4Uhx_H95bo/edit?usp=sharing" target="_blank"><p style="font-size: 260%""><h1>Welcome to <game-title>Geimon!</game-title></a></h1></p>
        <h2>Home Page</h2>
    </div>
    <button class="button button" onclick="location.href='deck.html'" id="deckButton" style="display: none;">Deck Editor</button>
    &nbsp;&nbsp;
    <button class="button button" onclick="location.href='solo.html'" id="soloButton" style="display: none;">Solo Game</button>
    <br>
    <button class="button button" id="dynamicButton">Loading...</button>
    &nbsp;&nbsp;
    <button class="button button" onclick="location.href='single.html'" id="singleButton" style="display: none;">Single Game</button>
    <br>
    <button class="button button" id="logoutButton" style="display: none;">Logout</button> <!-- This is where the Logout button will appear -->
    &nbsp;&nbsp;
    <button class="button button" onclick="location.href='match.html'" id="matchButton" style="display: none;">Match Game</button>
<script>
        // Initialize Supabase client
        const supabaseUrl = 'https://your-project-id.supabase.co';  // Replace with your Supabase URL
        const supabaseKey = 'your-anon-key';  // Replace with your Supabase public anon key
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // Check login status using Supabase session
        window.onload = async function checkLoginStatus() {
            const user = supabase.auth.user(); // Check if user is logged in using Supabase's auth.user()

            const button = document.getElementById('dynamicButton');
            const logoutBtn = document.getElementById('logoutButton'); // Get the logout button
            const deckBtn = document.getElementById('deckButton');
            const soloBtn = document.getElementById('soloButton');
            const singleBtn = document.getElementById('singleButton');
            const matchBtn = document.getElementById('matchButton');

            if (user) {  // If the user is logged in
                button.textContent = 'User Profile';
                button.onclick = () => window.location.href = 'profile.html';

                // Show logout button and hide other buttons
                logoutBtn.style.display = 'inline-block';
                soloBtn.style.display = 'inline-block';
                singleBtn.style.display = 'inline-block';
                deckBtn.style.display = 'inline-block';
                matchBtn.style.display = 'inline-block';

                // Logout functionality
                logoutBtn.onclick = async () => {
                    await supabase.auth.signOut();  // Log the user out using Supabase's signOut method
                    location.reload();  // Reload the page to reflect changes
                };
            } else {  // If the user is not logged in
                button.textContent = 'Login';
                button.onclick = () => window.location.href = 'login.html';

                // Hide logout and game buttons if not logged in
                logoutBtn.style.display = 'none';
            }
        };

        // Handle dynamic button click based on login status
        const button = document.getElementById('dynamicButton');
        button.onclick = async function() {
            const user = supabase.auth.user(); // Get the logged-in user
            if (user) {
                window.location.href = 'profile.html'; // Redirect to profile page if logged in
            } else {
                window.location.href = 'login.html'; // Otherwise redirect to login page
            }
        };
    </script>
</body>
</html>
