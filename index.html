<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://fonts.googleapis.com/css?family=Racing Sans One' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <title>MAIN PAGE</title>
    <style>
        .header-container {
            display: flex;
            align-items: center; /* Vertically center the items */
        }
        .profile-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        h1 {
            font-size: 260%;
            margin: 0;
        }
        h2 {
            margin-top: 0;
        }
    </style>
</head>
<body style="background-color:rgb(0, 0, 0);">
    <div class="header-container">
        <a href="https://docs.google.com/document/d/1xF4fIeB9r2qQyF3x0cW7tvZFpIDo4apNW4Uhx_H95bo/edit?usp=sharing" target="_blank">
            <h1>Welcome to <game-title>Geimon!</game-title></h1>
        </a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <img id="profilePic" class="profile-pic" src="" alt="Profile Picture" style="display: none;">
    </div>
        <h2>Home Page</h2>

    <button class="button button" onclick="location.href='deck.html'" id="deckButton" style="display: none;">Deck Editor</button>
    &nbsp;&nbsp;
    <button class="button button" onclick="location.href='solo.html'" id="soloButton" style="display: none;">Solo Game</button>
    <br>
    <button class="button button" id="dynamicButton">Loading...</button>
    &nbsp;&nbsp;
    <button class="button button" onclick="location.href='single.html'" id="singleButton" style="display: none;">Single Game</button>
    <br>
    <button class="button button" id="logoutButton" style="display: none;">Logout</button>
    &nbsp;&nbsp;
    <button class="button button" onclick="location.href='match.html'" id="matchButton" style="display: none;">Match Game</button>

    <script>
        document.addEventListener('DOMContentLoaded', async function () {
        const button = document.getElementById('dynamicButton');
        const logoutBtn = document.getElementById('logoutButton');
        const deckBtn = document.getElementById('deckButton');
        const soloBtn = document.getElementById('soloButton');
        const singleBtn = document.getElementById('singleButton');
        const matchBtn = document.getElementById('matchButton');
        const profilePic = document.getElementById('profilePic');

        try {
            const res = await fetch('https://geimon-app-833627ba44e0.herokuapp.com/me', {
                credentials: 'include' // Important: include cookies
            });

            const data = await res.json();

            if (data.loggedIn) {
                button.textContent = 'User Profile';
                button.onclick = () => window.location.href = 'profile.html';

                logoutBtn.style.display = 'inline-block';
                soloBtn.style.display = 'inline-block';
                singleBtn.style.display = 'inline-block';
                deckBtn.style.display = 'inline-block';
                matchBtn.style.display = 'inline-block';

                logoutBtn.onclick = async () => {
                    await fetch('https://geimon-app-833627ba44e0.herokuapp.com/logout', {
                        credentials: 'include'
                    });
                    location.reload();
                };
                if (data.profilePic) {
                        profilePic.src = data.profilePic;  // Set profile picture URL
                        profilePic.style.display = 'inline';  // Show profile picture
                    } else {
                        // If no profile picture or default, hide it
                        profilePic.style.display = 'none';
                    }
            } else {
                throw new Error('Not logged in');
            }
        } catch (err) {
            console.log('User not logged in:', err);
            button.textContent = 'Login';
            button.onclick = () => window.location.href = 'login.html';
            logoutBtn.style.display = 'none';
        }
    });
    </script>
</body>
</html>