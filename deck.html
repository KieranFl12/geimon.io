<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://fonts.googleapis.com/css?family=Racing Sans One' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <title>Deck Page</title>
    <body style="background-color:rgb(78, 78, 78);">
    <style>
        .container {
            display: flex;
        }
    </style>
</head>
<body>
  <img src="https://geimon-app-833627ba44e0.herokuapp.com/Public/Images/Site Assets/try_2.png" class="bg-image" alt="">
    <div>
        <p style="font-size: 200%; text-align:center; font-size: 260%; text-shadow: 2px 2px 4px black, -2px -2px 4px black, 2px -2px 4px black, -2px 2px 4px black;"><game-title>Geimon!</game-title></p>
        <h2 id="deck-name" style="font-size: 200%; color:white; text-align:center; text-shadow: 2px 2px 4px black, -2px -2px 4px black, 2px -2px 4px black, -2px 2px 4px black; margin-top: 16px;"></h2>
    </div>
    <button class="button buttonEvenSmaller" onclick="window.close()" style="margin: 0 auto; text-align: center; display: block; display: flex; justify-content: center;">Close Deck</button>

    <div class="container">
      <div class="viewing-window" id="viewing-window">
        <div class="scaled-card" id="scaled-card"></div>
      </div>
        <div class="card-wrapper" id="card-wrapper"></div>
    </div>
    <div id="tooltip" class="tooltip"></div>

    <p class="empty-deck-message" id="empty-message" style="display: none;">This deck is currently empty.</p>

    <script type="module">
        import { cards } from "./data/cards.js";
        import { renderCard } from "./utils/cardRenderer.js";

        document.addEventListener("DOMContentLoaded", () => {
            //const sortedCards = cards.sort((a, b) => a.name.localeCompare(b.name));
            //sortedCards.forEach(card => renderCard(card, container));

            const container = document.getElementById("card-wrapper");
            const emptyMessage = document.getElementById("empty-message");
            const deckNameElement = document.getElementById("deck-name");
            const viewingWindow = document.getElementById("viewing-window");
            const scaledCardContainer = document.getElementById("scaled-card");
            let lastHoveredCard = null;

            const storedDeckName = localStorage.getItem("selectedDeckName") || "My Deck";
            deckNameElement.textContent = storedDeckName;

            container.innerHTML = "";  // Clear container before rendering

            const storedCards = localStorage.getItem("selectedDeckCards");
            const cardIds = storedCards ? JSON.parse(storedCards) : [];

            if (cardIds.length === 0) {
                emptyMessage.style.display = "block";
            } else {
                emptyMessage.style.display = "none";

                const deckCards = cardIds
                    .map(id => cards.find(card => String(card.id) === String(id)))
                    .filter(Boolean);

                console.log("Deck Card IDs:", cardIds);
                console.log("Matching cards found:");
                deckCards.forEach(card => console.log(card));

                deckCards.forEach(card => {
                const cardElement = renderCard(card, container);
                if (cardElement) {
                    console.log("Attaching event listener to:", cardElement);
                    cardElement.addEventListener("mouseenter", () => {
                        console.log("Mouse entered card:", cardElement);
                        scaledCardContainer.innerHTML = "";
                        const clone = cardElement.cloneNode(true);
                        clone.classList.add("scaled-card");
                        scaledCardContainer.appendChild(clone);
                        addTooltipListeners(clone);
                        lastHoveredCard = clone;
                    });
                } else {
                    console.warn("No card element found for card:", card);
                }
            });

            container.addEventListener("mouseleave", () => {
                if (lastHoveredCard) {
                    console.log("Mouse left container");
                    lastHoveredCard = null;
                }
            });
        }
    });
    </script>
</body>
</html>
